<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thom Benjamin Volker">

<title>gesyn - Practical 1: Introduction to synthetic data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="P1_files/libs/clipboard/clipboard.min.js"></script>
<script src="P1_files/libs/quarto-html/quarto.js"></script>
<script src="P1_files/libs/quarto-html/popper.min.js"></script>
<script src="P1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="P1_files/libs/quarto-html/anchor.min.js"></script>
<link href="P1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="P1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="P1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="P1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="P1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration"><span class="header-section-number">2</span> Data exploration</a></li>
  <li><a href="#generative-models" id="toc-generative-models" class="nav-link" data-scroll-target="#generative-models"><span class="header-section-number">3</span> Generative models</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">gesyn - Practical 1: Introduction to synthetic data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thom Benjamin Volker </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome to the first practical of the course! In this practical, we will work on the foundation of synthetic data generation: generative modelling. Specifically, we will work with the <code>disease</code> data, which consists of 232 patients of whom three variables are recorded:</p>
<ul>
<li><code>status</code>: whether the patient has survived (<code>deceased</code>, <code>recovered</code>);</li>
<li><code>stay</code>: how many days the patient has been hospitalized;</li>
<li><code>age</code>: the age of the patient.</li>
</ul>
<p>We will work on creating a synthetic version of this data data set. However, before we start with generating data, we need to get a basic understanding of the data (just throwing a model at a data set is <strong><em>always</em></strong> a bad idea).</p>
<section id="install-and-load-the-required-packages-and-fix-the-state-of-the-random-number-generator-to-ensure-reproducibility-of-your-results." class="level3">
<h3 class="anchored" data-anchor-id="install-and-load-the-required-packages-and-fix-the-state-of-the-random-number-generator-to-ensure-reproducibility-of-your-results.">1. Install and load the required packages, and fix the state of the random number generator to ensure reproducibility of your results.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># install.packages("psych")</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># install.packages("mvtnorm")</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-the-disease-data-and-load-it-into-r." class="level3">
<h3 class="anchored" data-anchor-id="download-the-disease-data-and-load-it-into-r.">2. Download the disease data and load it into <code>R</code>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>disease <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(<span class="st">"https://thomvolker.github.io/gesyn/data/disease.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-exploration" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data exploration</h1>
<section id="inspect-the-first-few-rows-of-the-data-using-head." class="level3">
<h3 class="anchored" data-anchor-id="inspect-the-first-few-rows-of-the-data-using-head.">3. Inspect the first few rows of the data using <code>head()</code>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">head</span>(disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">status</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">stay</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">recovered</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">recovered</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">recovered</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">recovered</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">23</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="get-descriptive-statistics-for-this-data-set.-how-many-people-have-recovered-and-what-is-the-average-age-in-the-sample" class="level3">
<h3 class="anchored" data-anchor-id="get-descriptive-statistics-for-this-data-set.-how-many-people-have-recovered-and-what-is-the-average-age-in-the-sample">4. Get descriptive statistics for this data set. How many people have recovered? And what is the average age in the sample?</h3>
<p><em>Hint: You might want to use <code>summary()</code> or <code>describe()</code> from the <code>psych()</code> package.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">summary</span>(disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       status         age             stay       
 deceased : 42   Min.   :52.00   Min.   : 1.000  
 recovered:190   1st Qu.:63.00   1st Qu.: 2.000  
                 Median :66.00   Median : 4.000  
                 Mean   :65.92   Mean   : 6.612  
                 3rd Qu.:70.00   3rd Qu.: 9.000  
                 Max.   :86.00   Max.   :52.000  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">describe</span>(disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">vars</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">trimmed</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">range</th>
<th style="text-align: right;">skew</th>
<th style="text-align: right;">kurtosis</th>
<th style="text-align: right;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">status*</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">1.818966</td>
<td style="text-align: right;">0.3858793</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.897849</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.6460623</td>
<td style="text-align: right;">0.7126484</td>
<td style="text-align: right;">0.0253342</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">65.922414</td>
<td style="text-align: right;">5.6171519</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">65.983871</td>
<td style="text-align: right;">5.9304</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.0243344</td>
<td style="text-align: right;">0.1571293</td>
<td style="text-align: right;">0.3687841</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stay</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">6.612069</td>
<td style="text-align: right;">7.5412534</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.053763</td>
<td style="text-align: right;">2.9652</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">2.7291176</td>
<td style="text-align: right;">9.6124730</td>
<td style="text-align: right;">0.4951075</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="visualize-the-distributions-of-the-variables-status-stay-and-age.-what-do-you-think-of-their-distributions" class="level3">
<h3 class="anchored" data-anchor-id="visualize-the-distributions-of-the-variables-status-stay-and-age.-what-do-you-think-of-their-distributions">5. Visualize the distributions of the variables <code>status</code>, <code>stay</code> and <code>age</code>. What do you think of their distributions?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> status)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_histogram(stat = "count", fill = "lightblue"): Ignoring unknown
parameters: `binwidth`, `bins`, and `pad`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> stay)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="generative-models" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Generative models</h1>
<p>We will now start with generating synthetic data. For the moment, we will focus on univariate modelling strategies, and forget for the moment that the relationships between variables are also important. We will focus on multivariate modelling at a later moment.</p>
<section id="generate-232-new-samples-from-a-binomial-distribution." class="level3">
<h3 class="anchored" data-anchor-id="generate-232-new-samples-from-a-binomial-distribution.">6. Generate 232 new samples from a binomial distribution.</h3>
<p><em>Hint: Use <code>rbinom()</code> with <code>size = 1</code>, and <code>prob</code> set to the proportion of individuals who recovered.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>syn_status <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(disease), </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="at">prob =</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(disease<span class="sc">$</span>status) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"deceased"</span>, <span class="st">"recovered"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-the-distributions-of-the-original-status-variable-with-your-synthetic-status-variable.-are-they-comparable" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-distributions-of-the-original-status-variable-with-your-synthetic-status-variable.-are-they-comparable">7. Compare the distributions of the original <code>status</code> variable with your synthetic <code>status</code> variable. Are they comparable?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">summary</span>(disease<span class="sc">$</span>status)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> deceased recovered 
       42       190 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">summary</span>(syn_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> deceased recovered 
       40       192 </code></pre>
</div>
</div>
<p>The counts are slightly different, but the difference is relatively small. It seems a realistic synthetic version of the original variable.</p>
</section>
<section id="do-you-think-it-is-appropriate-to-generate-a-synthetic-age-variable-from-a-normal-distribution-why-or-why-not" class="level3">
<h3 class="anchored" data-anchor-id="do-you-think-it-is-appropriate-to-generate-a-synthetic-age-variable-from-a-normal-distribution-why-or-why-not">8. Do you think it is appropriate to generate a synthetic <code>age</code> variable from a normal distribution? Why or why not?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, </span>
<span id="cb16-4"><a href="#cb16-4"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(disease<span class="sc">$</span>age), </span>
<span id="cb16-5"><a href="#cb16-5"></a>                            <span class="at">sd =</span> <span class="fu">sd</span>(disease<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># A normal distribution comes rather close to the original distribution of the</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># variable age, so in terms of distributional similarity: yes, a normal</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># distribution is appropriate. However, a normal distribution is real-valued,</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># whether age is recorded as integer numbers only. Still, we can solve for this</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># by rounding the generated age values.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generate-232-synthetic-age-values-from-a-normal-distribution-and-round-the-sampled-values." class="level3">
<h3 class="anchored" data-anchor-id="generate-232-synthetic-age-values-from-a-normal-distribution-and-round-the-sampled-values.">9. Generate 232 synthetic <code>age</code> values from a normal distribution, and round the sampled values.</h3>
<p><em>Hint:</em> You can use the function <code>rnorm()</code>, and borrow the mean and standard deviation from the original variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>syn_age <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(disease),</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(disease<span class="sc">$</span>age),</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(disease<span class="sc">$</span>age)</span>
<span id="cb18-5"><a href="#cb18-5"></a>) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-the-distributions-of-the-original-age-variable-with-your-synthetic-age-variable.-are-they-comparable" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-distributions-of-the-original-age-variable-with-your-synthetic-age-variable.-are-they-comparable">10. Compare the distributions of the original <code>age</code> variable with your synthetic <code>age</code> variable. Are they comparable?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> syn_age), <span class="at">fill =</span> <span class="st">"darkblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The distributions are not identical, but indeed very similar, which is what we want.</p>
</section>
<section id="compare-the-distribution-of-the-variable-stay-with-a-normal-distribution-a-lognormal-distribution-i.e.-the-exponent-of-a-normally-distributed-variable-and-a-poisson-distribution-using-the-figure-below.-which-distribution-is-most-appropriate" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-distribution-of-the-variable-stay-with-a-normal-distribution-a-lognormal-distribution-i.e.-the-exponent-of-a-normally-distributed-variable-and-a-poisson-distribution-using-the-figure-below.-which-distribution-is-most-appropriate">11. Compare the distribution of the variable <code>stay</code> with a normal distribution, a lognormal distribution (i.e., the exponent of a normally distributed variable) and a Poisson distribution using the figure below. Which distribution is most appropriate?</h3>
<p><strong>OPTIONAL:</strong> If you have plenty of time left, program this comparison yourself. You can use <code>ggplot()</code> in combination with <code>stat_function</code>, using the functions <code>dnorm</code>, <code>dlnorm</code> and <code>dpois</code>. Pay close attention to the input arguments of these functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> stay)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Normal"</span>),</span>
<span id="cb20-4"><a href="#cb20-4"></a>                <span class="at">fun =</span> <span class="sc">~</span><span class="fu">dnorm</span>(.x, </span>
<span id="cb20-5"><a href="#cb20-5"></a>                             <span class="at">mean =</span> <span class="fu">mean</span>(disease<span class="sc">$</span>stay), </span>
<span id="cb20-6"><a href="#cb20-6"></a>                             <span class="at">sd =</span> <span class="fu">sd</span>(disease<span class="sc">$</span>stay))) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Log-normal"</span>),</span>
<span id="cb20-8"><a href="#cb20-8"></a>                <span class="at">fun =</span> <span class="sc">~</span><span class="fu">dlnorm</span>(.x,</span>
<span id="cb20-9"><a href="#cb20-9"></a>                              <span class="at">meanlog =</span> <span class="fu">mean</span>(<span class="fu">log</span>(disease<span class="sc">$</span>stay)),</span>
<span id="cb20-10"><a href="#cb20-10"></a>                              <span class="at">sdlog =</span> <span class="fu">sd</span>(<span class="fu">log</span>(disease<span class="sc">$</span>stay)))) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Poisson"</span>),</span>
<span id="cb20-12"><a href="#cb20-12"></a>                <span class="at">n =</span> <span class="dv">71</span>,</span>
<span id="cb20-13"><a href="#cb20-13"></a>                <span class="at">fun =</span> <span class="sc">~</span><span class="fu">dpois</span>(.x, <span class="at">lambda =</span> <span class="fu">mean</span>(disease<span class="sc">$</span>stay))) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">55</span>) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>, <span class="at">type =</span> <span class="st">"div"</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="generate-a-synthetic-version-of-the-variable-stay-by-exponentiating-all-n-232-values-from-a-normal-distribution.-again-round-the-drawn-values." class="level3">
<h3 class="anchored" data-anchor-id="generate-a-synthetic-version-of-the-variable-stay-by-exponentiating-all-n-232-values-from-a-normal-distribution.-again-round-the-drawn-values.">12. Generate a synthetic version of the variable <code>stay</code> by exponentiating all <code>n = 232</code> values from a normal distribution. Again round the drawn values.</h3>
<p><em>Hint: Because we exponentiate the values, we need to provide the mean and standard deviation on the log scale.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>syn_stay <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="at">n =</span> <span class="dv">232</span>,</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="fu">log</span>(disease<span class="sc">$</span>stay)),</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(<span class="fu">log</span>(disease<span class="sc">$</span>stay))</span>
<span id="cb21-5"><a href="#cb21-5"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">exp</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="fu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-the-distributions-of-the-original-stay-variable-with-your-synthetic-stay-variable.-are-they-comparable" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-distributions-of-the-original-stay-variable-with-your-synthetic-stay-variable.-are-they-comparable">13. Compare the distributions of the original <code>stay</code> variable with your synthetic <code>stay</code> variable. Are they comparable?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">ggplot</span>(disease, <span class="fu">aes</span>(<span class="at">x =</span> stay)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> syn_stay), <span class="at">fill =</span> <span class="st">"darkblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="separate-the-data-into-two-groups-based-on-the-variable-status." class="level3">
<h3 class="anchored" data-anchor-id="separate-the-data-into-two-groups-based-on-the-variable-status.">14. Separate the data into two groups based on the variable <code>status</code>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>deceased <span class="ot">&lt;-</span> <span class="fu">filter</span>(disease, status <span class="sc">==</span> <span class="st">"deceased"</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>recovered <span class="ot">&lt;-</span> <span class="fu">filter</span>(disease, status <span class="sc">==</span> <span class="st">"recovered"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="for-each-of-these-groups-estimate-the-means-and-covariance-matrix-of-the-two-variables-age-and-stay.-again-use-logstay." class="level3">
<h3 class="anchored" data-anchor-id="for-each-of-these-groups-estimate-the-means-and-covariance-matrix-of-the-two-variables-age-and-stay.-again-use-logstay.">15. For each of these groups, estimate the means and covariance matrix of the two variables, <code>age</code> and <code>stay</code>. Again use <code>log(stay)</code>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>means_deceased <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">mean</span>(deceased<span class="sc">$</span>age), </span>
<span id="cb24-2"><a href="#cb24-2"></a>                    <span class="st">"stay"</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">log</span>(deceased<span class="sc">$</span>stay)))</span>
<span id="cb24-3"><a href="#cb24-3"></a>means_recovered <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">mean</span>(recovered<span class="sc">$</span>age),</span>
<span id="cb24-4"><a href="#cb24-4"></a>                     <span class="st">"stay"</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">log</span>(recovered<span class="sc">$</span>stay)))</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a>var_deceased <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">data.frame</span>(<span class="at">age =</span> deceased<span class="sc">$</span>age,</span>
<span id="cb24-7"><a href="#cb24-7"></a>                               <span class="at">stay =</span> <span class="fu">log</span>(deceased<span class="sc">$</span>stay)))</span>
<span id="cb24-8"><a href="#cb24-8"></a>var_recovered <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">data.frame</span>(<span class="at">age =</span> recovered<span class="sc">$</span>age,</span>
<span id="cb24-9"><a href="#cb24-9"></a>                                <span class="at">stay =</span> <span class="fu">log</span>(recovered<span class="sc">$</span>stay)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="use-your-previously-created-status-variable-and-for-each-of-the-two-groups-draw-synthetic-values-for-age-and-stay." class="level3">
<h3 class="anchored" data-anchor-id="use-your-previously-created-status-variable-and-for-each-of-the-two-groups-draw-synthetic-values-for-age-and-stay.">16. Use your previously created <code>status</code> variable, and for each of the two groups, draw synthetic values for <code>age</code> and <code>stay</code>.</h3>
<p>Create a synthetic data set for the two groups separately. Draw these synthetic sets from a bivariate normal distribution, with the means and (co-)variances specified according to the just estimated values.</p>
<p><em>Hint: You can use <code>rmvnorm</code> from the <code>mvtnorm</code>-package.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>syn_deceased <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="at">n =</span> <span class="fu">sum</span>(syn_status <span class="sc">==</span> <span class="st">"deceased"</span>),</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="at">mean =</span> means_deceased,</span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="at">sigma =</span> var_deceased</span>
<span id="cb25-5"><a href="#cb25-5"></a>)</span>
<span id="cb25-6"><a href="#cb25-6"></a>syn_recovered <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="at">n =</span> <span class="fu">sum</span>(syn_status <span class="sc">==</span> <span class="st">"recovered"</span>),</span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="at">mean =</span> means_recovered,</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="at">sigma =</span> var_recovered</span>
<span id="cb25-10"><a href="#cb25-10"></a>)</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a>syn <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb25-13"><a href="#cb25-13"></a>  <span class="st">"deceased"</span> <span class="ot">=</span> <span class="fu">data.frame</span>(syn_deceased),</span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="st">"recovered"</span> <span class="ot">=</span> <span class="fu">data.frame</span>(syn_recovered),</span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="at">.id =</span> <span class="st">"status"</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>) <span class="sc">|&gt;</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-18"><a href="#cb25-18"></a>    <span class="at">status =</span> <span class="fu">factor</span>(status),</span>
<span id="cb25-19"><a href="#cb25-19"></a>    <span class="at">age =</span> <span class="fu">round</span>(age),</span>
<span id="cb25-20"><a href="#cb25-20"></a>    <span class="at">stay =</span> <span class="fu">exp</span>(stay) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb25-21"><a href="#cb25-21"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="optional-compare-the-univariate-distributions-of-the-variables-in-your-final-synthetic-data-set-with-the-distributions-in-the-observed-data.-also-compare-the-correlations-between-the-variables.-how-good-is-the-synthetic-data" class="level3">
<h3 class="anchored" data-anchor-id="optional-compare-the-univariate-distributions-of-the-variables-in-your-final-synthetic-data-set-with-the-distributions-in-the-observed-data.-also-compare-the-correlations-between-the-variables.-how-good-is-the-synthetic-data">17. OPTIONAL: Compare the univariate distributions of the variables in your final synthetic data set with the distributions in the observed data. Also compare the correlations between the variables. How good is the synthetic data?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> disease<span class="sc">$</span>age, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> syn<span class="sc">$</span>age, <span class="at">col =</span> <span class="st">"Synthetic"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> disease<span class="sc">$</span>stay, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> syn<span class="sc">$</span>stay, <span class="at">col =</span> <span class="st">"Synthetic"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="P1_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">cor</span>(<span class="fu">sapply</span>(disease, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           status        age       stay
status  1.0000000  0.3010599 -0.1313469
age     0.3010599  1.0000000 -0.0257513
stay   -0.1313469 -0.0257513  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">cor</span>(<span class="fu">sapply</span>(syn, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            status          age         stay
status  1.00000000  0.341287830 -0.060386533
age     0.34128783  1.000000000 -0.008524173
stay   -0.06038653 -0.008524173  1.000000000</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>